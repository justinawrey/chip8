var a=new Uint8Array(4056);Y();function Y(){a.set([240,144,144,144,240],0),a.set([32,96,32,32,112],5),a.set([240,16,240,128,240],10),a.set([240,16,240,16,240],15),a.set([144,144,240,16,16],20),a.set([240,128,240,16,240],25),a.set([240,128,240,144,240],30),a.set([240,16,32,64,64],35),a.set([240,144,240,144,240],40),a.set([240,144,240,16,240],45),a.set([240,144,240,144,144],50),a.set([224,144,224,144,224],55),a.set([240,128,128,128,240],60),a.set([224,144,144,144,224],65),a.set([240,128,240,128,240],70),a.set([240,128,240,128,128],75)}function F(t){q();let n=new Uint8Array(t);a.set(n,512)}function q(){a.fill(0,512)}var h=[],z={v0:0,v1:0,v2:0,v3:0,v4:0,v5:0,v6:0,v7:0,v8:0,v9:0,vA:0,vB:0,vC:0,vD:0,vE:0,vF:0,addressIndex:0,delayTimer:0,soundTimer:0,programCounter:512},J={v0:"V0",v1:"V1",v2:"V2",v3:"V3",v4:"V4",v5:"V5",v6:"V6",v7:"V7",v8:"V8",v9:"V9",vA:"VA",vB:"VB",vC:"VC",vD:"VD",vE:"VE",vF:"VF",addressIndex:"I",delayTimer:"DT",soundTimer:"ST",programCounter:"PC"},r=new Proxy(z,{set(t,n,o,u){function c(s,d){return s<0?(s=Math.abs(s),d-s%d):s%d}return typeof n=="symbol"?Reflect.set(t,n,o,u):n.startsWith("v")||n==="delayTimer"||n==="soundTimer"?Reflect.set(t,n,c(o,256),u):n==="addressIndex"||n==="programCounter"?Reflect.set(t,n,c(o,65536),u):!1}});function i(t){return`v${Number(t).toString(16).toUpperCase()}`}function b(t,n,o){return t<<8|n<<4|o}function m(t,n){return t<<4|n}function D(){for(let t in r)r[t]=0;r.programCounter=512,h=[]}function N(){for(let t in r){let n=document.getElementById(`reg-${t}`);n&&(n.innerHTML=`<b>${J[t]}</b>: ${r[t]}`)}}var Q=document.getElementsByTagName("canvas")[0],l=Q.getContext("2d"),p=64,H=32,g=10,M="#FFFFFF",O="#000000",ee="#EEEEEE",te="#333333",I=new Array(p*H).fill(!1);function K(){I.fill(!1)}function k(){l.fillStyle=M,l.fillRect(0,0,p*g,H*g)}function T(){I.forEach((t,n)=>{l.beginPath(),t?l.fillStyle=E?M:O:l.fillStyle=E?O:M;let o=n%p,u=Math.floor(n/p);l.rect(o*g,u*g,g,g),l.fill(),U&&(l.strokeStyle=E?te:ee,l.stroke())})}function e(t,n){let o=n*p+t,u=I[o],c=!1;return u?(I[o]=!1,c=!0):I[o]=!0,c}var U=!0;function $(t){U=t}var E=!0;function P(){E=!E}function L(){I.fill(!1),e(11,8),e(12,8),e(13,8),e(14,8),e(15,8),e(10,19),e(11,19),e(12,19),e(13,19),e(14,19),e(15,19),e(10,8),e(10,9),e(10,10),e(10,11),e(10,12),e(10,13),e(10,14),e(10,15),e(10,16),e(10,17),e(10,18),e(19,11),e(19,12),e(19,13),e(19,14),e(19,15),e(19,16),e(19,17),e(19,18),e(19,19),e(19,20),e(19,21),e(19,22),e(19,23),e(24,11),e(24,12),e(24,13),e(24,14),e(24,15),e(24,16),e(24,17),e(24,18),e(24,19),e(24,20),e(24,21),e(24,22),e(24,23),e(20,17),e(21,17),e(22,17),e(23,17),e(28,8),e(29,8),e(30,8),e(31,8),e(32,8),e(28,19),e(29,19),e(30,19),e(31,19),e(32,19),e(30,9),e(30,10),e(30,11),e(30,12),e(30,13),e(30,14),e(30,15),e(30,16),e(30,17),e(30,18),e(36,11),e(36,12),e(36,13),e(36,14),e(36,15),e(36,16),e(36,17),e(36,18),e(36,19),e(36,20),e(36,21),e(36,22),e(36,23),e(41,11),e(41,12),e(41,13),e(41,14),e(41,15),e(41,16),e(41,17),e(37,17),e(38,17),e(39,17),e(40,17),e(37,11),e(38,11),e(39,11),e(40,11),e(44,14),e(45,14),e(48,8),e(48,9),e(48,10),e(48,11),e(48,12),e(48,13),e(48,14),e(48,15),e(48,16),e(48,17),e(48,18),e(53,8),e(53,9),e(53,10),e(53,11),e(53,12),e(53,13),e(53,14),e(53,15),e(53,16),e(53,17),e(53,18),e(53,19),e(49,8),e(50,8),e(51,8),e(52,8),e(48,19),e(49,19),e(50,19),e(51,19),e(52,19),e(49,13),e(50,13),e(51,13),e(52,13),T()}var f=class{constructor(){this.pressed=!1}};function B(t){let n=v[t];n.pressed=!0}function _(t){let n=v[t];n.pressed=!1}function w(t){return v[t].pressed}function G(){for(let t in v)if(w(t))return t;return null}var v={0:new f,1:new f,2:new f,3:new f,4:new f,5:new f,6:new f,7:new f,8:new f,9:new f,A:new f,B:new f,C:new f,D:new f,E:new f,F:new f};var se={7:128,6:64,5:32,4:16,3:8,2:4,1:2,0:1};var oe=()=>k(),ce=()=>{let t=h.pop();t&&(r.programCounter=t)},ie=({c:t,b:n,a:o})=>{r.programCounter=b(t,n,o)},ae=({c:t,b:n,a:o})=>{h.push(r.programCounter),r.programCounter=b(t,n,o)},de=({c:t,b:n,a:o})=>{r[i(t)]===m(n,o)&&(r.programCounter+=2)},fe=({c:t,b:n,a:o})=>{r[i(t)]!==m(n,o)&&(r.programCounter+=2)},ue=({c:t,b:n})=>{r[i(t)]===r[i(n)]&&(r.programCounter+=2)},le=({c:t,b:n,a:o})=>{r[i(t)]=m(n,o)},xe=({c:t,b:n,a:o})=>{r[i(t)]+=m(n,o)},me=({c:t,b:n})=>{r[i(t)]=r[i(n)]},ge=({c:t,b:n})=>{r[i(t)]|=r[i(n)]},Ie=({c:t,b:n})=>{r[i(t)]&=r[i(n)]},ve=({c:t,b:n})=>{r[i(t)]^=r[i(n)]},ye=({c:t,b:n})=>{let o=r[i(t)]+r[i(n)];r.vF=o>255?1:0,r[i(t)]=o&255},be=({c:t,b:n})=>{let o=r[i(t)]-r[i(n)];r.vF=o>0?1:0,r[i(t)]=o},Ee=({c:t})=>{r.vF=(r[i(t)]&1)===1?1:0,r[i(t)]/=2},pe=({c:t,b:n})=>{let o=r[i(n)]-r[i(t)];r.vF=o>0?1:0,r[i(t)]=o},Te=({c:t})=>{r.vF=(r[i(t)]&128)>>7===1?1:0,r[i(t)]*=2},he=({c:t,b:n})=>{r[i(t)]!==r[i(n)]&&(r.programCounter+=2)},ke=({c:t,b:n,a:o})=>{r.addressIndex=b(t,n,o)},we=({c:t,b:n,a:o})=>{r.programCounter=b(t,n,o)+r.v0},Ce=({c:t,b:n,a:o})=>{r[i(t)]=Math.floor(Math.random()*256)&m(n,o)},Re=({c:t,b:n,a:o})=>{let u=r[i(t)],c=r[i(n)],s=a.slice(r.addressIndex,r.addressIndex+o);r.vF=0,s.forEach((d,y)=>{for(let x=7;x>=0;x--)!((se[x]&d)>>x)||e(u+7-x,c+y)&&(r.vF=1)})},Se=({c:t})=>{let n=r[i(t)].toString(16);w(n)&&(r.programCounter+=2)},Me=({c:t})=>{let n=r[i(t)].toString(16);w(n)||(r.programCounter+=2)},Le=({c:t})=>{r[i(t)]=r.delayTimer},Be=({c:t})=>{for(;;){let n=G();if(n){r[i(t)]=parseInt(n,16);break}}},_e=({c:t})=>{r.delayTimer=r[i(t)]},Ae=({c:t})=>{r.soundTimer=r[i(t)]},Fe=({c:t})=>{r.addressIndex+=r[i(t)]},Ve=({c:t})=>{r.addressIndex=r[i(t)]*5+0},De=({c:t})=>{let n=r[i(t)],o=Math.floor(n/100),u=Math.floor(n%100/10),c=n%10;a[r.addressIndex]=o,a[r.addressIndex+1]=u,a[r.addressIndex+2]=c},Ne=({c:t})=>{for(let n=0;n<=t;n++)a[r.addressIndex+n]=r[i(n)]},Oe=({c:t})=>{for(let n=0;n<=t;n++)r[i(n)]=a[r.addressIndex+n]};function He(t){let n=(61440&t)>>12,o=(3840&t)>>8,u=(240&t)>>4,c=(15&t)>>0,s={d:n,c:o,b:u,a:c},d=!0;switch(n){case 0:c===0&&oe(s),c===14&&ce(s);break;case 1:ie(s),d=!1;break;case 2:ae(s),d=!1;break;case 3:de(s);break;case 4:fe(s);break;case 5:ue(s);break;case 6:le(s);break;case 7:xe(s);break;case 8:c===0&&me(s),c===1&&ge(s),c===2&&Ie(s),c===3&&ve(s),c===4&&ye(s),c===5&&be(s),c===6&&Ee(s),c===7&&pe(s),c===14&&Te(s);break;case 9:he(s);break;case 10:ke(s);break;case 11:we(s),d=!1;break;case 12:Ce(s);break;case 13:Re(s);break;case 14:c===14&&Se(s),c===1&&Me(s);break;case 15:u===5&&c===5?Ne(s):u===6&&c===5?Oe(s):c===5&&_e(s),c===7&&Le(s),c===10&&Be(s),c===8&&Ae(s),c===14&&Fe(s),c===9&&Ve(s),c===3&&De(s)}return d}var Z=He;var Ke=700,W=60,Ue=1e3,C,R,S;function A(t,n){return setInterval(t,Ue/n)}function $e(){C||(C=A(Pe,Ke)),R||(R=A(j("delayTimer"),W)),S||(S=A(j("soundTimer"),W))}function X(){clearInterval(C),clearInterval(R),clearInterval(S),C=void 0,R=void 0,S=void 0,D(),k(),K()}function j(t){return()=>{r[t]>0&&(r[t]-=1)}}function Pe(){let t=a[r.programCounter],n=a[r.programCounter+1],o=t<<8|n;Z(o)&&(r.programCounter+=2),T(),document.getElementById("hardware").checked&&N()}document.addEventListener("DOMContentLoaded",()=>{L(),Object.keys(v).forEach(c=>{let s=document.getElementById(`key-${c}`);s.addEventListener("mousedown",()=>B(c)),s.addEventListener("mouseup",()=>_(c)),globalThis.addEventListener("keydown",d=>{d.key===c.toLowerCase()&&(B(c),s.classList.add("pressed"))}),globalThis.addEventListener("keyup",d=>{d.key===c.toLowerCase()&&(_(c),s.classList.remove("pressed"))})}),document.getElementById("rom").addEventListener("change",async c=>{let s=c.target.value;if(s==="default"){X(),L();return}(await fetch(`rom/${s}.ch8`)).arrayBuffer().then(y=>F(new Uint8Array(y))),X(),$e()}),document.getElementById("grid").addEventListener("change",c=>{$(c.target.checked),document.getElementById("rom").value==="default"&&T()}),document.getElementById("theme").addEventListener("change",()=>{P(),document.getElementById("rom").value==="default"&&T()}),document.getElementById("hardware").addEventListener("change",c=>{if(c.target.checked){let d=document.createElement("div");d.id="reg-hardware";for(let y in r){let x=document.createElement("div");x.id=`reg-${y}`,d.appendChild(x)}document.getElementsByClassName("container")[0].appendChild(d)}else document.getElementById("reg-hardware")?.remove()})});
